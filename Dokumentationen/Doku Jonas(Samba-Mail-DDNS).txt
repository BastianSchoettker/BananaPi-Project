3.7	Mail-Server
Um Statusbenachrichtigungen zu erhalten, wurde ein Mail-Server auf dem Pi eingerichtet, welcher als Relay über GoogleMail fungiert. Dazu wurde ein GoogleMail Konto eingerichtet, auf welches PostFix zugreift und Mails verschickt. 
Alle SystemMails werden Über das Google-Konto weitergeleitet, dazu gehören auch Statusmeldungen des Backup-Skripts.
Dieser Weg wurde wegen des geringen Aufwands gewählt. Ohne Relay würde man eine eigene Domain und sehr viel mehr Konfiguration benötigen. Da ein GoogleMail Konto nie verfällt, war dies die beste und pflegeleichteste Möglichkeit.
Weiterhin können die Mails auch an jede beliebige Adresse verschickt werden, dies ist im Mail-Server frei konfigurierbar. Die Mails gehen momentan an die GoogleMail Adresse.

3.7.1 Einrichtung

Vorraussetzungen:
- Internetzugriff
- GoogleMail-Konto
- Texteditor (Nano)
- SSH/Physikalischen Zugriff


PostFix installieren:
apt-get update
apt-get install postfix libsasl2-modules bsd-mailx

Das Konfigurationsfenster öffnet sich:
	Internet mit Smarthost
	Mailname: smtp.gmail.com
	Hostname: bananapi

TLS/SSL aktivieren:
nano /etc/postfix/main.cf

Folgendes Einfügen:
smtp_sasl_auth_enable = yes
# noplaintext weglassen, wenn Passwörter im Klartext übertragen werden müssen:
# (nicht empfohlen, nur wenn's anders nicht funktioniert)
smtp_sasl_security_options = noanonymous
smtp_sasl_password_maps = hash:/etc/postfix/sasl_password
# verschluesselung einschalten
smtp_tls_security_level = may

Nutzerdaten des GoogleMail-Kontos hinterlegen:
nano /etc/postfix/sasl_password
smtp.gmail.com Bananapihfu:<Password>

Datei nur für root lesbar machen, da klartext:
chmod 600 /etc/postfix/sasl_password 

Postfix lookup tabelle erstellen:
postmap hash:/etc/postfix/sasl_password

Postfix neustarten:
/etc/init.d/postfix restart

Für Weiterleitung der Systemnachrichten aliases bearbeiten:
nano /etc/aliases 
root: bananapihfu@gmail.com //Oder Wunschemail an welche Systemnachrichten gesendet werden

Änderungen an Aliases wirksam machen:
Newaliases

Quelle: 
http://my5cent.spdns.de/allgemein/banana-pi-postfix-installieren-und-einrichten.html


3.8	Samba
Um den Dateizugriff zu erleichtern, wurde ein Samba-Server auf dem Pi implementiert.
Samba ermöglicht es von nahezu jedem Gerät auf ein Freigegebenes Verzeichniss auf dem Server zuzugreifen. Vorraussetzung ist, dass das Client Betriebssystem das SMB-Protokoll unterstützt.
Die meisten modernen Betriebssysteme, wie Windows, MacOS und andere Unixoide besitzen Samba funktionalität.

3.8.1 Einrichtung
Vorraussetzungen:
- Internetzugriff
- Texteditor (Nano)
- SSH/Physikalischen Zugriff

Samba installieren:
sudo apt-get update
sudo apt-get install samba

Benutzer für Samba erstellen (Hat keinen Shell-Zugriff):
useradd sambausr --shell /bin/false

Passwort für den Benutzer in Samba setzen:
smbpasswd -a <user_name>

Verzeichniss im Homer erstellen:
Bei einem anderen Verzeichniss muss die smb.conf auch angepasst werden!
mkdir /home/sambausr
mkdir /home/sambausr/samba

Berechtigungen setzen:
chown sambausr:sambausr /home/sambausr/
chown sambausr:sambausr /home/sambausr/samba/

Backup der Samba Konfiguration im home-Verzeichniss machen:
cp /etc/samba/smb.conf ~

Config bearbeiten:
nano /etc/samba/smb.conf

folgendes am Ende der Konfiguration Einfügen:
[samba]
path = /home/sambausr/samba
valid users = sambausr
read only = no

Service neustarten:
service smbd restart

Config testen:
testparm

Verbinden:
\\<IP>\samba

Quelle: https://help.ubuntu.com/community/How%20to%20Create%20a%20Network%20Share%20Via%20Samba%20Via%20CLI%20%28Command-line%20interface/Linux%20Terminal%29%20-%20Uncomplicated%2C%20Simple%20and%20Brief%20Way%21#About_This_Guide
 



3.9	DDNS
Um immer die aktuelle IP-Adresse des Pi zur Hand zu haben, wurde ein DynDNS-Client von no-ip implementiert, bei jedem Systemstart wird die bei der DNS hinterlegte IP-Adresse aktualisiert.
Nachteil hierbei ist jedoch, dass man alle 30 Tage diese Domain aktivieren muss, da diese sonst verfällt.
Um dies zu umgehen wurde die Kostenfreie Domain bananapihfu.tk gebucht. Von Vorteil ist hier, dass diese Domain eine Laufzeit von einem Jahr hat und nach Ablauf auch ohne Mehrkosten verlängert werden kann.
Diese Domain wird bei Cloudflare verwaltet, da hier auch eine API angeboten wird, mit welcher man Theoretisch komplett auf eine Dynamische DNS bei No-IP verzichten kann.

3.9.1 Einrichtung No-IP
Vorraussetzungen:
- Internetzugriff
- SSH/Physikalischen Zugriff
- NoIP.com Account

NoIP Hostnamen anlegen:
Man muss in No-IP den gewünschten Hostnamen einrichten, welcher später auf die aktuelle IP-Adresse verweist.

Verzeichniss für DDNS im Home-Verzeichniss erstellen und wechseln:
mkdir DDNS
cd DDNS

NoIP-Client von NoIP.com beziehen:
wget https://www.noip.com/client/linux/noip-duc-linux.tar.gz

Das Archiv entpacken:
tar xvf noip-duc-linux.tar.gz

In den Entpackten Ordner wechseln:
cd noip-x.x.x-x (cd noip eingeben und mit TAB vervollständigen)

Client bauen und installieren:
make && make install

Konfiguration wird gestartet:
Auto configuration for Linux client of no-ip.com.

Multiple network devices have been detected.

Please select the Internet interface from this list.

By typing the number associated with it.
0       eth0.101 -> WAN Interface auswählen
1       eth0.201
2       eth0.202

0

Please enter the login/email string for no-ip.com  bananapihfu
Please enter the password for user 'bananapihfu'  ***********

Only one host [armbianhfu.ddns.net] is registered to this account.
It will be used.
Please enter an update interval:[30]  30
Do you wish to run something at successful update?[N] (y/N)  N

New configuration file '/usr/local/etc/no-ip2.conf' created.

Um den Daemon automatisch bei Systemstart zu starten muss noch folgende Konfiguration vorgenommen werden:
Start-Scipt unter /etc/init.d/noip2 ablegen:
vim /etc/init.d/noip2

Script "noip2" kopieren und einfügen:
Siehe Anhang

Script ausführbar machen:
chmod a+rx /etc/init.d/noip2

Quelle: https://www.togaware.com/linux/survivor/No_IP_Manual.html

3.9.2 Einrichtung Custom-Domain
Vorraussetzungen:
- Account bei Cloudflare

Domain bei Freenom.com aussuchen:
Hier gibt es jede Menge kostenfreie Domains

Domain registrieren















